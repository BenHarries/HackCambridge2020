<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Requiblack meta tags -->
    <meta charset="utf-8"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
            crossorigin="anonymous"
    />

    <title>Hack Cambridge 2020</title>

    <style>
        div.scrollmenu {
            background-color: rgb(201, 201, 201);
            overflow: auto;
            white-space: nowrap;
        }

        div.scrollmenu a {
            display: inline-block;
            color: white;
            text-align: center;
            padding: 14px;
            text-decoration: none;
        }

        div.scrollmenu a:hover {
            background-color: #777;
        }

        div.scrollmenu a:active {
            background-color: #777;
        }
    </style>

    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/dbea95f351.js" crossorigin="anonymous"></script>
    <script src="./index.js"></script>

</head>

<body>
<!-- Heading -->
<nav class="navbar navbar-light bg-light">
    <span class="navbar-brand mb-0 h1 ">Hack Cambridge 2020</span>
    <a class="nav-link" href="https://github.com/BenHarries/HackCambridge2020" target="_blank"> <i
            class="fas fa-external-link-alt fa-2x"></i> </i></a>
</nav>

<!-- Words / Selector Split -->
<div class="container">
    <div class="row" style="padding-top: 20px;">
        <!-- Words -->
        <div class="col-8">

            <span id="words">hello my name is ben</span>

        </div>

        <!-- Selector Split -->
        <div class="col-4" id="Selector">
            <!-- Card -->
            <div
                    class="card border-info mb-3"
                    style="max-width: 18rem;"
            >
                <button
                        type="button"
                        class="btn btn-success btn-lg btn-block"
                        id="speechsdkStartContinuousRecognition"
                >
                    Start
                </button>
                <div class="card-body text-info">
                    <div id="label-container"></div>
                    <div id="filler-label-container">
                        <div class="progress">
                            <div
                                    class="progress-bar progress-bar-striped}"
                                    role="progressbar"
                                    aria-valuenow="0"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                            ></div>
                        </div>
                        <br/>
                        <div class="progress">
                            <div
                                    class="progress-bar progress-bar-striped}"
                                    role="progressbar"
                                    aria-valuenow="0"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                            ></div>
                        </div>
                        <br/>
                        <div class="progress">
                            <div
                                    class="progress-bar progress-bar-striped}"
                                    role="progressbar"
                                    aria-valuenow="0"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                            ></div>
                        </div>
                        <br/>
                        <div class="progress">
                            <div
                                    class="progress-bar progress-bar-striped}"
                                    role="progressbar"
                                    aria-valuenow="0"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                            ></div>
                        </div>
                    </div>
                </div>

                <div
                        class="card-footer bg-transparent border-info text-info"
                        id="footer"
                >
                    Accuracy:
                </div>

                <div id="sequence"></div>
            </div>
        </div>
    </div>
</div>

<style>
    .char-green {
        color: green;
    }

    .char-black {
        color: black;
    }
</style>


//     <!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"
></script>
<script
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"
></script>
<script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"
></script>

<!-- Speech SDK REFERENCE -->
<script src="microsoft.cognitiveservices.speech.sdk.bundle.js"></script>


<!-- Speech SDK USAGE -->
<script>
    // On document load resolve the Speech SDK dependency
    function Initialize(onComplete) {
        if (!!window.SpeechSDK) {
            onComplete(window.SpeechSDK);
        }
    }

    let angus = " ";
    var phraseDiv, statusDiv;
    var phrases;
    var SpeechSDK;
    var recognizer;

    var reco;
    var sdkStartContinousRecognitionBtn, sdkStopContinousRecognitionBtn;
    var voiceOutput;

    var soundContext = undefined;
    try {
        var AudioContext = window.AudioContext // our preferred impl
            || window.webkitAudioContext       // fallback, mostly when on Safari
            || false;                          // could not find.

        if (AudioContext) {
            soundContext = new AudioContext();
        } else {
            alert("Audio context not supported");
        }
    } catch (e) {
        window.console.log("no sound context found, no audio output. " + e);
    }

    document.addEventListener("DOMContentLoaded", function () {
        createBtn = document.getElementById("createBtn");
        sdkStartContinousRecognitionBtn = document.getElementById("speechsdkStartContinuousRecognition");
        sdkStopContinousRecognitionBtn = document.getElementById("speechsdkStopContinuousRecognition");
        phraseDiv = document.getElementById("phraseDiv");
        statusDiv = document.getElementById("statusDiv");
        phrases = document.getElementById("phrases");
        voiceOutput = document.getElementById("voiceOutput");

        // Starts continuous speech recognition.
        sdkStartContinousRecognitionBtn.addEventListener("click", function () {
            var lastRecognized = "";

            // If an audio file was specified, use it. Else use the microphone.
            var audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();

            var speechConfig;
            speechConfig = SpeechSDK.SpeechConfig.fromSubscription("f9bef20c5e064a65b33c3467e56f8e8b", "westus");

            speechConfig.speechRecognitionLanguage = 'en-US';
            reco = new SpeechSDK.SpeechRecognizer(speechConfig, audioConfig);

            // Before beginning speech recognition, setup the callbacks to be invoked when an event occurs.

            // The event recognizing signals that an intermediate recognition result is received.
            // You will receive one or more recognizing events as a speech phrase is recognized, with each containing
            // more recognized speech. The event will contain the text for the recognition since the last phrase was recognized.
            reco.recognizing = function (s, e) {
                angus = lastRecognized + e.result.text;
                add_word()

            };

            // The event recognized signals that a final recognition result is received.
            // This is the final event that a phrase has been recognized.
            // For continuous recognition, you will get one recognized event for each phrase recognized.
            reco.recognized = function (s, e) {
                window.console.log(e);

                // Indicates that recognizable speech was not detected, and that recognition is done.
                if (e.result.reason === SpeechSDK.ResultReason.NoMatch) {
                    var noMatchDetail = SpeechSDK.NoMatchDetails.fromResult(e.result);
                } else {
                    compareText(e.result.text);
                }

                lastRecognized += e.result.text + "\r\n";
            };

            reco.canceled = function (s, e) {
            };

            // Signals that a new session has started with the speech service
            reco.sessionStarted = function (s, e) {
            };

            // Signals the end of a session with the speech service.
            reco.sessionStopped = function (s, e) {
                sdkStartContinousRecognitionBtn.disabled = false;
            };

            // Signals that the speech service has started to detect speech.
            reco.speechStartDetected = function (s, e) {
            };

            // Signals that the speech service has detected that speech has stopped.
            reco.speechEndDetected = function (s, e) {
            };

            // Starts recognition
            reco.startContinuousRecognitionAsync();
            sdkStartContinousRecognitionBtn.disabled = true;
        });


        var audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
        var speechConfig;
        speechConfig = SpeechSDK.SpeechConfig.fromSubscription("f9bef20c5e064a65b33c3467e56f8e8b", "westus");

        speechConfig.speechRecognitionLanguage = "en-US";
        reco = new SpeechSDK.IntentRecognizer(speechConfig, audioConfig);


        reco.recognizing = function (s, e) {
        };
        reco.canceled = function (s, e) {
        };

        // The event recognized signals that a final recognition result is received.
        // This is the final event that a phrase has been recognized.
        // For continuous recognition, you will get one recognized event for each phrase recognized.
        reco.recognized = function (s, e) {

            // Depending on what result reason is returned, different properties will be populated.
            switch (e.result.reason) {
                // This case occurs when speech was successfully recognized, but the speech did not match an intent from the Language Understanding Model.
                case SpeechSDK.ResultReason.RecognizedSpeech:
                    break;

                // Both speech an intent from the model was recognized.
                case SpeechSDK.ResultReason.RecognizedIntent:
                    // The actual JSON returned from Language Understanding is a bit more complex to get to, but it is available for things like
                    // the entity name and type if part of the intent.
                    break;

                // No match was found.
                case SpeechSDK.ResultReason.NoMatch:
                    var noMatchDetail = SpeechSDK.NoMatchDetails.fromResult(e.result);
                    break;
            }
        };

        // Signals that a new session has started with the speech service
        reco.sessionStarted = function (s, e) {
        };

        // Signals the end of a session with the speech service.
        reco.sessionStopped = function (s, e) {
            sdkStartContinousRecognitionBtn.disabled = false;
            sdkStopContinousRecognitionBtn.disabled = true;
        };

        // Signals that the speech service has started to detect speech.
        reco.speechStartDetected = function (s, e) {
        };

        // Signals that the speech service has detected that speech has stopped.
        reco.speechEndDetected = function (s, e) {
        };

        Initialize(function (speechSdk) {
            SpeechSDK = speechSdk;
        });
    });


    function changeColour(currentWord) {
        document.getElementById(currentWord).className = "char-green";

    }
    function addInNewSentence(currentWordCount) {
        var new_words = "i enjoy pizza";
        var span = document.getElementById('words'),
            text = new_words.split(' ').map((el, i) => {
                // console.log(i,currentWordCount);
                var a = parseInt(i) + parseInt(currentWordCount);
                return '<span class="char-' + 'black' + '" id = "' + a + '">' + el + ' ' + '</span>';
            }).join('');
        span.innerHTML += text;
        return (new_words.split(' ').length)
    }

    var span = document.getElementById('words'),
        text = span.innerHTML.split(' ').map((el, i) => {
            return '<span class="char-' + 'black' + '" id = "' + i + '">' + el + ' ' + '</span>';
        }).join('');
    span.innerHTML = text;


    var currentWord = 0;
    currentWordCount = document.getElementById('words').children.length;
    var newWord = 0;
    var lengthPrevSentence = 5;

    function add_word() {
        console.log(document.getElementById(newWord).innerHTML, newWord);
        if ((angus + " ").includes(document.getElementById(newWord).innerHTML)) {

            changeColour(newWord.toString());
            currentWord += 1;
            newWord += 1;

        }
        if (currentWord >= lengthPrevSentence) {
            lengthPrevSentence = addInNewSentence(newWord);
            currentWord = 0;

        }


    }

    add_word();
</script>
</body>
</html>
